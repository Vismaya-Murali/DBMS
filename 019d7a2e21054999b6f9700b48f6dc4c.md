> **DBMS PROJECT REPORT**\
> TREATS ON TRACKS

+-----------------------+-----------------------+-----------------------+
| > **Name**            | > **SRN**             | > **Section**         |
+=======================+=======================+=======================+
| > Vismaya M           | > PES1UG22CS706       | > L                   |
+-----------------------+-----------------------+-----------------------+
| > Venkata Sravani     | > PES1UG22CS685       | > L                   |
| > Revuri              |                       |                       |
+-----------------------+-----------------------+-----------------------+

**E-R DIAGRAM**

> ![](vertopal_019d7a2e21054999b6f9700b48f6dc4c/media/image1.png){width="6.7402766841644794in"
> height="4.094443350831146in"}

**RELATIONAL SCHEMA**

> ![](vertopal_019d7a2e21054999b6f9700b48f6dc4c/media/image2.png){width="7.655555555555556in"
> height="9.073610017497813in"}
>
> **Create Operations**
>
> 1\. **Insert Passenger Details and Login Credentials During
> Registration**
>
> INSERT INTO passenger(PassengerID, Fname, Lname, Phone, email)
>
> VALUES (%s, %s, %s, %s, %s)
>
> ○ Adds a new passenger\'s personal details (first name, last name,
> phone, and
>
> email) to the passenger table.
>
> INSERT INTO Login (LoginID, Password, user_id, is_admin) VALUES
>
> (%s, %s, %s, %s)
>
> ○ Adds login details for a passenger, including their role (admin or
> user), in the
>
> Login table.
>
> ![](vertopal_019d7a2e21054999b6f9700b48f6dc4c/media/image3.png){width="6.052777777777778in"
> height="2.8444444444444446in"}
>
> ![](vertopal_019d7a2e21054999b6f9700b48f6dc4c/media/image4.png){width="6.083333333333333in"
> height="2.6347222222222224in"}

+-----------------------------------+-----------------------------------+
| 2\.                               | > **Create MySQL User and Grant   |
|                                   | > Privileges**                    |
+===================================+===================================+
+-----------------------------------+-----------------------------------+

> CREATE USER IF NOT EXISTS %s@\'localhost\' IDENTIFIED BY %s;
>
> ○ Creates a new MySQL user if they don't already exist.
>
> GRANT ALL PRIVILEGES ON \*.\* TO %s@\'localhost\' WITH GRANT OPTION;
>
> ○ Grants full privileges to admin users.
>
> GRANT SELECT, INSERT ON \*.\* TO %s@\'localhost\';
>
> GRANT UPDATE ON passenger TO %s@\'localhost\';
>
> ○ Grants limited privileges (select, insert) to regular users, with
> update privileges
>
> only on the passenger table.
>
> 3\. **Place an Order**
>
> INSERT INTO orders (OrderID, Order_date, R_ID, S_ID,
>
> Passenger_id) VALUES (%s, %s, %s, %s, %s)
>
> ○ Inserts a new order into the orders table with details like order
> ID, date,
>
> restaurant ID, station ID, and passenger ID.
>
> INSERT INTO orderitems (OrdItemID, ItemPrice, quantity, Order_id,
>
> R_ID, ItemID) VALUES (%s, %s, %s, %s, %s, %s)
>
> ○ Adds each ordered item's price, quantity, order ID, restaurant ID,
> and item ID into
>
> orderitems.

![](vertopal_019d7a2e21054999b6f9700b48f6dc4c/media/image5.png){width="6.5in"
height="3.5930555555555554in"}

> (BASED ON USER SELECTION)
>
> 4\. **Record Payment Details**
>
> INSERT INTO payment (order_id, paymentID, payment_method, date)
>
> VALUES (%s, %s, %s, %s)
>
> ○ Inserts a new payment record with details like order ID, payment ID,
> method, and
>
> date.

![](vertopal_019d7a2e21054999b6f9700b48f6dc4c/media/image6.png){width="6.5in"
height="1.801388888888889in"}

+-----------------------------------+-----------------------------------+
| 5\.                               | > **Add New Menu Item**           |
+===================================+===================================+
+-----------------------------------+-----------------------------------+

> INSERT INTO menu (Res_ID, ItemID, Item_name, Price, Image,
>
> Quantity) VALUES (%s, %s, %s, %s, %s, %s)
>
> ○ Inserts a new menu item with details like restaurant ID, item ID,
> name, price,
>
> image, and quantity.

![](vertopal_019d7a2e21054999b6f9700b48f6dc4c/media/image7.png){width="6.5in"
height="3.0in"}

> **Read Operations**
>
> 1\. **Login Query**
>
> SELECT user_id, is_admin FROM Login WHERE LoginID = %s AND
>
> Password = %s
>
> ○ Verifies login credentials and retrieves user_id and role (is_admin)
> for a user.
>
> ![](vertopal_019d7a2e21054999b6f9700b48f6dc4c/media/image8.png){width="6.166666666666667in"
> height="2.198611111111111in"}
>
> ![](vertopal_019d7a2e21054999b6f9700b48f6dc4c/media/image9.png){width="6.176388888888889in"
> height="2.3541666666666665in"}![](vertopal_019d7a2e21054999b6f9700b48f6dc4c/media/image10.png){width="6.5in"
> height="4.06123031496063in"}
>
> 2\. **Fetch Restaurants and Menu Items for Admin Dashboard** SELECT
> Rname, Location, Phno, RID FROM restaurant

+-----------------------------------+-----------------------------------+
| ○                                 | > Retrieves all restaurants for   |
|                                   | > display in the admin dashboard. |
+===================================+===================================+
+-----------------------------------+-----------------------------------+

![](vertopal_019d7a2e21054999b6f9700b48f6dc4c/media/image11.png){width="6.5in"
height="4.051388888888889in"}

> SELECT Item_name, Price, Image FROM menu WHERE Res_ID = %s
>
> ○ Retrieves all menu items for each restaurant.

![](vertopal_019d7a2e21054999b6f9700b48f6dc4c/media/image12.png){width="6.5in"
height="3.2805555555555554in"}

> 3\. **Fetch User Profile Information**
>
> SELECT PassengerID, Fname, Lname, Phone, email FROM passenger
>
> WHERE PassengerID = %s
>
> ○ Retrieves profile details of a passenger based on their ID.

![](vertopal_019d7a2e21054999b6f9700b48f6dc4c/media/image13.png){width="6.5in"
height="1.8847211286089238in"}![](vertopal_019d7a2e21054999b6f9700b48f6dc4c/media/image14.png){width="6.5in"
height="4.06123031496063in"}

> 4\. **Fetch Train Stops Based on Train ID**\
> SELECT s.Station_id, st.Sname FROM stops s JOIN Station st ON
> s.Station_id = st.StationID WHERE s.Train_id = %s

+-----------------------+-----------------------+-----------------------+
| 5\.                   | ○                     | > Retrieves all stops |
|                       |                       | > of a train with     |
|                       |                       | > station IDs and     |
|                       |                       | > names.              |
+=======================+=======================+=======================+
|                       | > **Fetch All         |                       |
|                       | > Trains**            |                       |
+-----------------------+-----------------------+-----------------------+

> SELECT TrainID, TrainName FROM train

+-----------------------------------+-----------------------------------+
| ○                                 | > Retrieves all train IDs and     |
|                                   | > names.                          |
+===================================+===================================+
+-----------------------------------+-----------------------------------+

![](vertopal_019d7a2e21054999b6f9700b48f6dc4c/media/image15.png){width="6.5in"
height="4.051388888888889in"}

> 6\. **Fetch Restaurants at a Specific Station**
>
> SELECT Rname, RID, Phno FROM restaurant WHERE Station_id = %s

+-----------------------------------+-----------------------------------+
| > ○ Fetches all restaurants       |                                   |
| > available at a specified        |                                   |
| > station.                        |                                   |
| >                                 |                                   |
| > ![](vertopal_019d7a2e21054      |                                   |
| 999b6f9700b48f6dc4c/media/image16 |                                   |
| .png){width="5.280555555555556in" |                                   |
| > height="3.129166666666667in"}   |                                   |
+===================================+===================================+
| 7\.                               | > **Fetch Menu Items at a         |
|                                   | > Restaurant**                    |
+-----------------------------------+-----------------------------------+

> SELECT Item_name, Price, Image, quantity FROM menu WHERE Res_ID = %s

![](vertopal_019d7a2e21054999b6f9700b48f6dc4c/media/image17.png){width="6.5in"
height="4.0527766841644794in"}

+-----------------------------------+-----------------------------------+
| ○                                 | > Retrieves menu items available  |
|                                   | > at a selected restaurant.       |
+===================================+===================================+
+-----------------------------------+-----------------------------------+

> **Update Operations**
>
> 1\. **Update Restaurant Details**\
> UPDATE restaurant SET Rname = %s, Location = %s, Phno = %s WHERE RID =
> %s
>
> ○ Updates the details of a restaurant (name, location, phone) based on
> its ID.

![](vertopal_019d7a2e21054999b6f9700b48f6dc4c/media/image18.png){width="6.5in"
height="2.9680555555555554in"}

+-----------------------------------+-----------------------------------+
| 2\.                               | > **Update User Profile**         |
+===================================+===================================+
+-----------------------------------+-----------------------------------+

> UPDATE passenger SET Fname = %s, Lname = %s, Phone = %s, email =
>
> %s WHERE PassengerID = %s
>
> ○ Updates a passenger's profile details (first name, last name, phone,
> and email).

![](vertopal_019d7a2e21054999b6f9700b48f6dc4c/media/image19.png){width="6.5in"
height="2.9902777777777776in"}

![](vertopal_019d7a2e21054999b6f9700b48f6dc4c/media/image20.png){width="6.5in"
height="2.948611111111111in"}

+-----------------------------------+-----------------------------------+
| 3\.                               | > **Update Menu Item**            |
+===================================+===================================+
+-----------------------------------+-----------------------------------+

> SELECT ItemID FROM menu WHERE Res_ID = %s AND ItemID = %s
>
> ○ Checks if an item exists in a restaurant's menu by item ID.

![](vertopal_019d7a2e21054999b6f9700b48f6dc4c/media/image7.png){width="6.5in"
height="3.0in"}

> UPDATE menu SET Item_name = %s, Price = %s, Image = %s, Quantity = %s
>
> WHERE Res_ID = %s AND ItemID = %s

+-----------------------------------+-----------------------------------+
| ○                                 | > Updates details of an existing  |
|                                   | > menu item (name, price, image,  |
|                                   | > quantity).                      |
+===================================+===================================+
+-----------------------------------+-----------------------------------+

> **Delete Operations**
>
> 1\. **Delete a Menu Item**
>
> DELETE FROM menu WHERE Res_ID = %s AND Item_name = %s AND Price =
>
> %s
>
> ○ Deletes a specific menu item from a restaurant's menu based on
> restaurant ID,
>
> item name, and price.
>
> Trying to delete shrek from menu by pressing the '-' button

![](vertopal_019d7a2e21054999b6f9700b48f6dc4c/media/image21.png){width="6.5in"
height="2.988888888888889in"}

> After delete

![](vertopal_019d7a2e21054999b6f9700b48f6dc4c/media/image22.png){width="6.5in"
height="3.1666655730533684in"}

![](vertopal_019d7a2e21054999b6f9700b48f6dc4c/media/image23.png){width="6.5in"
height="3.0in"}

> **FUNCTIONS:**
>
> The CalculateTotalPrice function calculates the total price for an
> order by summing the cost of each item's quantity and price.
>
> DELIMITER \$\$
>
> DROP FUNCTION IF EXISTS CalculateTotalPrice \$\$
>
> CREATE FUNCTION CalculateTotalPrice(order_id VARCHAR(20)) RETURNS
> DECIMAL(10,2)\
> DETERMINISTIC\
> BEGIN\
> DECLARE total_amount DECIMAL(10,2) DEFAULT 0;
>
> SELECT SUM(oi.quantity \* m.Price)\
> INTO total_amount\
> FROM orderitems oi\
> JOIN menu m ON oi.R_ID = m.Res_ID AND oi.ItemID = m.ItemID WHERE
> oi.Order_id = order_id;
>
> RETURN total_amount;\
> END \$\$
>
> DELIMITER ;
>
> **Declare Variable**: Initializes total_amount to store the total
> cost.
>
> **Calculate Total**:
>
> ● Joins orderitems (oi) and menu (m) on R_ID and ItemID to match
> restaurant and item IDs.
>
> ● Multiplies each item's quantity by its price and sums the results
> for the specified order_id.
>
> **Return Total**: Returns total_amount as the total order cost.

![](vertopal_019d7a2e21054999b6f9700b48f6dc4c/media/image24.png){width="6.5in"
height="3.5in"}

> **TRIGGER:**
>
> DROP TRIGGER IF EXISTS update_menu_quantity;
>
> DELIMITER //
>
> CREATE TRIGGER update_menu_quantity\
> AFTER INSERT ON orderitems\
> FOR EACH ROW\
> BEGIN\
> DECLARE current_quantity INT;
>
> \-- Fetch the current stock of the ordered item\
> SELECT quantity INTO current_quantity\
> FROM menu\
> WHERE ItemID = NEW.ItemID AND Res_ID = NEW.R_ID;\
> \-- Validate stock availability\
> IF current_quantity \>= NEW.quantity THEN\
> \-- Deduct ordered quantity from stock
>
> UPDATE menu\
> SET quantity = quantity - NEW.quantity\
> WHERE ItemID = NEW.ItemID AND Res_ID = NEW.R_ID;\
> ELSE\
> \-- Raise error if stock is insufficient\
> SIGNAL SQLSTATE \'45000\' SET MESSAGE_TEXT = \'Insufficient stock for
> the requested quantity.\';\
> END IF;\
> END //
>
> DELIMITER ;
>
> This trigger, update_menu_quantity, is triggered after a new row is
> inserted into the orderitems table:
>
> ● **Purpose**: It checks if there's enough stock in the menu table for
> the ordered item. If there is, it reduces the item's quantity in the
> menu table accordingly. If not, it raises an error to indicate
> insufficient stock.
>
> ● **Key Steps**:
>
> ○ The current_quantity of the item is fetched from the menu table.○
> The trigger checks if this stock is enough for the new order\'s
> quantity.
>
> ○ If sufficient, the menu quantity is decreased; if insufficient, an
> error message is raised with SIGNAL.
>
> **FRONTEND:**
>
> Food Item Mutton Chops is being ordered (10 quantity which is equal to
> available amount also reflected in backend)
>
> ![](vertopal_019d7a2e21054999b6f9700b48f6dc4c/media/image25.png){width="5.865277777777778in"
> height="2.698610017497813in"}
>
> ![](vertopal_019d7a2e21054999b6f9700b48f6dc4c/media/image26.png){width="5.916666666666667in"
> height="2.488888888888889in"}
>
> AFTER ORDER IS PLACED
>
> ![](vertopal_019d7a2e21054999b6f9700b48f6dc4c/media/image27.png){width="5.865277777777778in"
> height="2.7708333333333335in"}
>
> BACKEND:
>
> ![](vertopal_019d7a2e21054999b6f9700b48f6dc4c/media/image28.png){width="5.801388888888889in"
> height="2.2180544619422573in"}
>
> 2\)
>
> DELIMITER \$\$
>
> CREATE TRIGGER update_last_modified\
> BEFORE UPDATE ON menu\
> FOR EACH ROW\
> BEGIN\
> SET NEW.last_modified = CURRENT_TIMESTAMP;\
> END\$\$
>
> DELIMITER ;
>
> This trigger automatically updates the last_modified column to the
> current timestamp whenever a row in the menu table is updated.
>
> It is a BEFORE UPDATE trigger, meaning it fires before any update
> occurs.
>
> The trigger sets the last_modified field to CURRENT_TIMESTAMP for the
> updated row.
>
> This ensures that the last_modified column is always up-to-date with
> the current time whenever a row in the menu table is modified.
>
> BEFORE UPDATE:
>
> ![](vertopal_019d7a2e21054999b6f9700b48f6dc4c/media/image29.png){width="6.0625in"
> height="3.9680555555555554in"}
>
> AFTER UPDATE:
>
> ![](vertopal_019d7a2e21054999b6f9700b48f6dc4c/media/image30.png){width="5.865277777777778in"
> height="3.4583333333333335in"}
>
> **NESTED QUERY:**\
> SELECT m.Item_name, m.Price, r.Rname\
> FROM menu m\
> JOIN restaurant r ON m.Res_ID = r.RID\
> WHERE m.Price \> (\
> SELECT AVG(Price)\
> FROM menu\
> WHERE Res_ID = %s\
> )\
> AND m.Res_ID = %s
>
> ![](vertopal_019d7a2e21054999b6f9700b48f6dc4c/media/image31.png){width="5.4375in"
> height="3.5722222222222224in"}
>
> This query retrieves the names, prices, and restaurant names of items
> from a restaurant\'s menu where the item\'s price is greater than the
> restaurant\'s average menu price.
>
> 1\. **Subquery**:
>
> ○ SELECT AVG(Price) FROM menu WHERE Res_ID = %s: Calculates the
> average price of all menu items for a specific restaurant.
>
> 2\. **Outer Query**:
>
> ○ SELECT m.Item_name, m.Price, r.Rname: Selects the item name, price,
> and restaurant name.
>
> ○ WHERE m.Price \> (\...) AND m.Res_ID = %s: Filters items with a
> price greater than the average price calculated by the subquery for
> the given restaurant ID.
>
> In short, it fetches items that are more expensive than the average
> price of that restaurant.
>
> **AGGREGATE QUERIES**
>
> 1\. Calculating the Average Price for a Specific Restaurant using
> 'AVG'
>
> SELECT AVG(Price) FROM menu WHERE Res_ID = rid
>
> ● **Aggregate Function Used:** AVG()
>
> ● **Purpose:** The AVG() function calculates the average price of all
> menu items for a specific restaurant, identified by Res_ID.

![](vertopal_019d7a2e21054999b6f9700b48f6dc4c/media/image32.png){width="6.5in"
height="3.4472222222222224in"}

> The query retrieves the average price of items from the menu table
> where the Res_ID matches the given rid.
>
> It retrieves the details of items whose prices are greater than the
> average price calculated for a specific restaurant.
>
> 2\. Calculating the total price of an order using 'SUM'\
> SELECT SUM(oi.quantity \* m.Price)\
> INTO total_amount\
> FROM orderitems oi\
> JOIN menu m ON oi.R_ID = m.Res_ID AND oi.ItemID = m.ItemID WHERE
> oi.Order_id = order_id;
>
> ● **Aggregate Function Used:** SUM()\
> ● **Purpose:** The SUM() function calculates the total amount for an
> order by adding up the cost of each item in the order.
>
> The query multiplies the quantity of each item (oi.quantity) in the
> orderitems table by the Price of the item (m.Price) from the menu
> table.
>
> The resulting sum, representing the total price of all items in the
> specified order
>
> **TABLES**
>
> ![](vertopal_019d7a2e21054999b6f9700b48f6dc4c/media/image33.png){width="4.3125in"
> height="3.5305555555555554in"}
>
> PASSENGER
>
> ![](vertopal_019d7a2e21054999b6f9700b48f6dc4c/media/image34.png){width="5.740277777777778in"
> height="3.5416666666666665in"}
>
> LOGIN
>
> ![](vertopal_019d7a2e21054999b6f9700b48f6dc4c/media/image35.png){width="4.208333333333333in"
> height="2.812498906386702in"}
>
> MENU TABLE
>
> ![](vertopal_019d7a2e21054999b6f9700b48f6dc4c/media/image36.png){width="6.333333333333333in"
> height="2.9375in"}
>
> ORDERS TABLE
>
> ![](vertopal_019d7a2e21054999b6f9700b48f6dc4c/media/image37.png){width="5.3125in"
> height="3.594443350831146in"}
>
> PAYMENT TABLE
>
> ![](vertopal_019d7a2e21054999b6f9700b48f6dc4c/media/image38.png){width="4.865277777777778in"
> height="2.448610017497813in"}
>
> RESTAURANTS![](vertopal_019d7a2e21054999b6f9700b48f6dc4c/media/image40.png){width="4.384722222222222in"
> height="4.988793744531933in"}
>
> ![](vertopal_019d7a2e21054999b6f9700b48f6dc4c/media/image39.png){width="5.958333333333333in"
> height="2.624998906386702in"}
>
> STATIONS
>
> TRAINS
>
> STOPS
>
> ![](vertopal_019d7a2e21054999b6f9700b48f6dc4c/media/image41.png){width="2.8847222222222224in"
> height="3.125in"}
>
> ORDER_ITEMS
>
> ![](vertopal_019d7a2e21054999b6f9700b48f6dc4c/media/image42.png){width="5.531944444444444in"
> height="3.5944444444444446in"}
>
> **FRONTEND**

![](vertopal_019d7a2e21054999b6f9700b48f6dc4c/media/image43.png){width="6.5in"
height="4.051388888888889in"}

![](vertopal_019d7a2e21054999b6f9700b48f6dc4c/media/image44.png){width="6.5in"
height="4.052777777777778in"}

![](vertopal_019d7a2e21054999b6f9700b48f6dc4c/media/image45.png){width="6.5in"
height="4.051388888888889in"}

![](vertopal_019d7a2e21054999b6f9700b48f6dc4c/media/image46.png){width="6.5in"
height="4.052777777777778in"}

![](vertopal_019d7a2e21054999b6f9700b48f6dc4c/media/image47.png){width="6.5in"
height="4.051388888888889in"}

![](vertopal_019d7a2e21054999b6f9700b48f6dc4c/media/image15.png){width="6.5in"
height="4.052777777777778in"}

![](vertopal_019d7a2e21054999b6f9700b48f6dc4c/media/image14.png){width="6.5in"
height="4.051388888888889in"}

![](vertopal_019d7a2e21054999b6f9700b48f6dc4c/media/image16.png){width="6.5in"
height="4.052777777777778in"}

![](vertopal_019d7a2e21054999b6f9700b48f6dc4c/media/image17.png){width="6.5in"
height="4.051388888888889in"}

![](vertopal_019d7a2e21054999b6f9700b48f6dc4c/media/image48.png){width="6.5in"
height="4.051388888888889in"}

![](vertopal_019d7a2e21054999b6f9700b48f6dc4c/media/image49.png){width="6.5in"
height="4.051388888888889in"}

![](vertopal_019d7a2e21054999b6f9700b48f6dc4c/media/image50.png){width="6.509722222222222in"
height="4.041665573053368in"}

> ADMIN

![](vertopal_019d7a2e21054999b6f9700b48f6dc4c/media/image51.png){width="6.5in"
height="4.051388888888889in"}

![](vertopal_019d7a2e21054999b6f9700b48f6dc4c/media/image10.png){width="6.5in"
height="4.051388888888889in"}

![](vertopal_019d7a2e21054999b6f9700b48f6dc4c/media/image52.png){width="6.509722222222222in"
height="4.051388888888889in"}

![](vertopal_019d7a2e21054999b6f9700b48f6dc4c/media/image11.png){width="6.5in"
height="4.052777777777778in"}

![](vertopal_019d7a2e21054999b6f9700b48f6dc4c/media/image53.png){width="6.5in"
height="4.051388888888889in"}

![](vertopal_019d7a2e21054999b6f9700b48f6dc4c/media/image54.png){width="6.5in"
height="4.052777777777778in"}
